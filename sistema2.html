<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#050505">
    <link rel="manifest" href="manifest.json">
    <title>BasePr√≥ Agenda</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@400;600;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #050505; color: white; padding: 10px; -webkit-tap-highlight-color: transparent; }
        .font-brand { font-family: 'Orbitron', sans-serif; }
        .card { background: #0a1118; border: 1px solid #1a2a3a; border-radius: 0.75rem; }
        .grid-vagas { display: grid; grid-template-columns: 50px repeat(5, 1fr); gap: 4px; }
        .cell-vaga { background: #111d29; border: 1px solid #1e3a5a; padding: 14px 2px; text-align: center; border-radius: 6px; font-size: 10px; cursor: pointer; user-select: none; }
        .vaga-cheia { color: #ef4444; font-weight: bold; background: rgba(239, 68, 68, 0.2); border-color: #ef4444 !important; }
        .vaga-livre { color: #22c55e; }
        input, select { background: #111d29 !important; border: 1px solid #1e3a5a !important; color: white !important; padding: 6px; border-radius: 6px; outline: none; font-size: 11px; width: 100%; }
        .tab-btn { padding: 14px; font-family: 'Orbitron', sans-serif; font-size: 10px; font-weight: bold; color: #4b5563; border-bottom: 2px solid transparent; flex: 1; text-align: center; }
        .tab-btn.active { color: #3b82f6; border-bottom: 2px solid #3b82f6; background: rgba(59, 130, 246, 0.05); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .alerta-vencimento { color: #ff4444 !important; font-weight: 900; text-shadow: 0 0 10px rgba(255, 68, 68, 0.6); }
    </style>
</head>
<body>

    <header class="max-w-7xl mx-auto mb-4 grid grid-cols-3 gap-2 text-center">
        <div class="card p-2 border-blue-900/50">
            <span class="text-[7px] text-blue-400 uppercase font-bold">Alunos</span>
            <div id="total-alunos" class="text-sm font-brand text-blue-300">0</div>
        </div>
        <div class="card p-2 border-green-900/50">
            <span class="text-[7px] text-green-400 uppercase font-bold">Pago</span>
            <div id="faturamento-recebido" class="text-sm font-brand text-green-500">R$ 0</div>
        </div>
        <div class="card p-2 border-red-900/50">
            <span class="text-[7px] text-red-400 uppercase font-bold">Pendente</span>
            <div id="faturamento-pendente" class="text-sm font-brand text-red-500">R$ 0</div>
        </div>
    </header>

    <nav class="flex border-b border-gray-800 mb-4 bg-[#0a1118] rounded-t-lg sticky top-0 z-20">
        <button class="tab-btn active" onclick="openTab('aba-alunos', this)">üë• ALUNOS</button>
        <button class="tab-btn" onclick="openTab('aba-agenda', this)">üìÖ AGENDA</button>
    </nav>

    <main class="max-w-7xl mx-auto">
        <section id="aba-alunos" class="tab-content active space-y-4">
            <div class="card p-3 flex gap-2 items-center">
                <input type="text" id="busca" onkeyup="render()" placeholder="üîç BUSCAR...">
                <button onclick="adicionarNovo()" class="bg-blue-600 w-12 h-10 rounded-lg font-bold text-xl">+</button>
                <button onclick="fecharMes()" class="bg-gray-800 border border-blue-500/50 text-blue-400 px-2 h-10 rounded-lg text-[8px] font-bold">M√äS</button>
            </div>
            <div class="card overflow-hidden">
                <div class="overflow-y-auto h-[calc(100vh-280px)]">
                    <table class="w-full text-left">
                        <thead class="text-[8px] font-brand text-blue-400 uppercase border-b border-gray-800 sticky top-0 bg-[#0a1118] z-10">
                            <tr>
                                <th class="p-3">Aluno / Plano</th>
                                <th class="p-3 text-center">R$</th>
                                <th class="p-3 text-center">Status</th>
                                <th class="p-3"></th>
                            </tr>
                        </thead>
                        <tbody id="tabela-alunos" class="text-[11px] divide-y divide-gray-800/50"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="aba-agenda" class="tab-content">
            <div class="card p-4 border-l-4 border-blue-500">
                <h2 class="text-blue-400 font-brand text-xs uppercase mb-6 italic">Ocupa√ß√£o (Cap: 8)</h2>
                <div class="grid-vagas mb-2">
                    <div></div>
                    <div class="text-center text-[8px] font-brand text-gray-600">SEG</div>
                    <div class="text-center text-[8px] font-brand text-gray-600">TER</div>
                    <div class="text-center text-[8px] font-brand text-gray-600">QUA</div>
                    <div class="text-center text-[8px] font-brand text-gray-600">QUI</div>
                    <div class="text-center text-[8px] font-brand text-gray-600">SEX</div>
                </div>
                <div id="grid-horarios" class="space-y-1"></div>
            </div>
        </section>
    </main>

    <script>
        if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); }

        const agendaInicial = {"06:00":{"Seg":7,"Ter":9,"Qua":7,"Qui":7,"Sex":9},"07:00":{"Seg":2,"Ter":6,"Qua":4,"Qui":7,"Sex":1},"08:00":{"Seg":7,"Ter":6,"Qua":7,"Qui":8,"Sex":8},"09:00":{"Seg":9,"Ter":0,"Qua":0,"Qui":6,"Sex":0},"12:00":{"Seg":5,"Ter":0,"Qua":5,"Qui":0,"Sex":0},"14:00":{"Seg":0,"Ter":6,"Qua":0,"Qui":7,"Sex":0},"15:00":{"Seg":0,"Ter":0,"Qua":0,"Qui":0,"Sex":5},"16:00":{"Seg":5,"Ter":2,"Qua":6,"Qui":3,"Sex":0},"17:00":{"Seg":7,"Ter":6,"Qua":4,"Qui":7,"Sex":5},"18:00":{"Seg":6,"Ter":5,"Qua":7,"Qui":7,"Sex":7},"19:00":{"Seg":8,"Ter":9,"Qua":7,"Qui":10,"Sex":0}};
        const nomesIniciais = ["Abel Henrique TP","Alexandro Zamarchi","Aline Basso","Aline Nascimento","Amanda Ceron","Andressa","Andressa Zanco","Angelis Gregory","Ariel De Moraes","Arno Reis","Arthur Xanxere","Artur da Luz","Aucapone Velasques","Benjamin Gambatto","Bruna","Bruno Gizoni","Bruno Mortele","Bruno Rampi","Caetano Kremer","Caetano Munieiro","Caetano Putti","Christian","Claudenice Funcional","Cristiane Brancher","Cristiano","Cristiano Baioto","Daia Ceolin","Darcy Junior","Davi Sausem","Debora Pelisser","Debora Tonetti Funcional","Diego Ceolin","Douglas Basso","Douglas Sales","Dyego","Ederson F. De Bastiane","Edinando Garghetti","Eduardo Henrique TP","Elizando Marcio","Erick","Evandro Brazzo","Felipe Bohrer","Fernanda","Fernando","Gabriel Brail","Gabriel Salvi","Gabriela Riva","Gerson Dal Piva","Gerson de Oliveira","Gerson Oliveira","Giovane Mueller","Graciane Brun","Guilherme Alonso","Guilherme Domingues","Heitor Gollo","Henrik Bonatti","Ian Roger","Isabela Araujo","Jaque","Jaqueline DalBelo","Jean Kasper","Joelson Gollo","Jo√£o Cleber","Jonathan Moura","J√∫lio Crian√ßa","J√∫lio Corr√™a","Kau√£ Cotia","Laura Trianta","Lazaro Sinval Dallrosa Dias","Luan Rodrigues","Lucas Chiesa","Lucas Conte","Lucas Luis","Luciana Franzen","Luciano Moretto","Lu√≠s Ot√°vio Lutz","Luiz Ot√°vio","Maico Furlanetto","Maksuel Gato","Marcelo","Marcelo Reginato","Marcos Cortina","Marcus TP","Maria Semprebom","Mari Mendes","Mariane Graef","Mateus Lima","Matheus Galinski","Maur√≠cio Pederssetti","Maur√≠cio Scharf","Miguel Gnoato","Miguel Zancanaro","Munari","Natalie","Nestor Franzen","Pablo Rodrigo","Pedro Augusto","Pedro Ian","Pietra","Rafa Cenci","Rafa Dalmolin","Rafael Araujo","Renan Tiara","Rodrigo","Rodrigo Castro","Rodrigo Leal","Silvio Putti","Simone Sausem","Solano Bueno De Lacerda","Tainan Zanchet","Thais filha do arno","Thiago Rossetto","Thiago TP","Vanderson","Vini Be","Vitor de Cesaro","Wesley Dalmolin","William Marcos","Willian Martins"];

        let ocupacao = JSON.parse(localStorage.getItem('S1_ocupacao')) || agendaInicial;
        let alunos = JSON.parse(localStorage.getItem('S1_alunos_v2')) || nomesIniciais.map(n => ({ id: Math.random().toString(36).substr(2, 9), nome: n, plano: 'mensal', valorTotal: 0, vencimento: '', pagoEsteMes: false }));

        function openTab(tabId, btn) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            btn.classList.add('active');
        }

        function save() {
            localStorage.setItem('S1_alunos_v2', JSON.stringify(alunos));
            localStorage.setItem('S1_ocupacao', JSON.stringify(ocupacao));
            render();
        }

        function render() {
            const lista = document.getElementById('tabela-alunos');
            const busca = document.getElementById('busca').value.toLowerCase();
            lista.innerHTML = "";
            let recebido = 0, pendente = 0;
            const hoje = new Date();

            alunos.sort((a,b) => a.nome.localeCompare(b.nome)).forEach(a => {
                const val = parseFloat(a.valorTotal) || 0;
                if(a.pagoEsteMes) recebido += val; else pendente += val;

                let clAlerta = "";
                if(a.vencimento) {
                    const dVenc = new Date(a.vencimento);
                    const diff = (dVenc - hoje) / (1000 * 60 * 60 * 24);
                    if(diff <= 3) clAlerta = "alerta-vencimento";
                }

                if(a.nome.toLowerCase().includes(busca)) {
                    lista.innerHTML += `
                        <tr>
                            <td class="p-3">
                                <input type="text" value="${a.nome}" onchange="up('${a.id}','nome',this.value.toUpperCase())" oncontextmenu="ajustarVenc('${a.id}');return false;" class="font-bold border-none bg-transparent ${clAlerta} mb-1">
                                <select onchange="up('${a.id}','plano',this.value)" class="text-[9px] h-6 opacity-60">
                                    <option value="mensal" ${a.plano=='mensal'?'selected':''}>MENSAL</option>
                                    <option value="trimestral" ${a.plano=='trimestral'?'selected':''}>TRIMESTRAL</option>
                                    <option value="semestral" ${a.plano=='semestral'?'selected':''}>SEMESTRAL</option>
                                </select>
                            </td>
                            <td class="p-3 text-center">
                                <input type="number" value="${a.valorTotal}" onchange="up('${a.id}','valorTotal',this.value)" class="text-green-500 font-bold text-center bg-transparent border-none w-14">
                            </td>
                            <td class="p-3 text-center">
                                <button onclick="togP('${a.id}')" class="w-full py-2 rounded text-[8px] font-black ${a.pagoEsteMes ? 'bg-green-600' : 'bg-red-900/40 text-red-500'}">${a.pagoEsteMes ? 'PAGO' : 'PENDENTE'}</button>
                            </td>
                            <td class="p-3 text-right">
                                <button onclick="exc('${a.id}')" class="text-gray-700">üóëÔ∏è</button>
                            </td>
                        </tr>`;
                }
            });
            document.getElementById('faturamento-recebido').innerText = `R$ ${recebido}`;
            document.getElementById('faturamento-pendente').innerText = `R$ ${pendente}`;
            document.getElementById('total-alunos').innerText = alunos.length;
            const grid = document.getElementById('grid-horarios'); grid.innerHTML = "";
            Object.keys(ocupacao).sort().forEach(h => {
                let row = `<div class="grid-vagas items-center"><div class="font-brand text-[8px] text-blue-400">${h}</div>`;
                ["Seg", "Ter", "Qua", "Qui", "Sex"].forEach(d => {
                    const n = ocupacao[h][d] || 0; const v = 8 - n;
                    row += `<div class="cell-vaga ${v <= 0 ? 'vaga-cheia' : 'vaga-livre'}" onclick="addV('${d}','${h}')" oncontextmenu="remV('${d}','${h}');return false;">${v <= 0 ? 'L' : v + 'V'}</div>`;
                });
                grid.innerHTML += row + `</div>`;
            });
        }
        function up(id, c, v) { const a = alunos.find(x => x.id === id); if(a) { a[c] = v; save(); } }
        function togP(id) { const a = alunos.find(x => x.id === id); a.pagoEsteMes = !a.pagoEsteMes; save(); }
        function addV(d, h) { ocupacao[h][d]++; save(); }
        function remV(d, h) { if(ocupacao[h][d] > 0) { ocupacao[h][d]--; save(); } }
        function exc(id) { if(confirm("Excluir Aluno?")) { alunos = alunos.filter(a => a.id !== id); save(); } }
        function ajustarVenc(id) {
            const a = alunos.find(x => x.id === id);
            const nV = prompt(`Vencimento para ${a.nome} (AAAA-MM-DD):`, a.vencimento || "");
            if(nV !== null) { a.vencimento = nV; save(); }
        }
        function adicionarNovo() { 
            const n = prompt("Nome do Aluno:"); 
            if(n) { 
                alunos.push({ id: Date.now().toString(), nome: n.toUpperCase(), plano: 'mensal', valorTotal: 0, vencimento: '', pagoEsteMes: false }); 
                save(); 
            } 
        }
        function fecharMes() { if(confirm("Virar o m√™s? Tudo ficar√° PENDENTE.")) { alunos.forEach(a => a.pagoEsteMes = false); save(); } }
        render();
    </script>
</body>
</html>